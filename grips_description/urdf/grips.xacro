<?xml version="1.0"?>
<robot name="grips" xmlns:xacro="http://www.ros.org/wiki/xacro">

	<!-- Import all Gazebo-customization elements, including Gazebo colors -->
	<xacro:include filename="$(find grips_description)/urdf/grips.gazebo" />
	
	<!-- Auxiliar Values -->
	<property name="pi" value="3.1415926535897931" />
	<property name="max_effort" value="200" />
  <property name="max_velocity" value="15" />
	<!-- Links Mass -->
	<property name="base_mass" value="1.208" />
	<property name="manifold_mass" value="41.111" />
	<property name="upper_arm_mass" value="3.592" />
	<property name="elbow_pivot_mass" value="0.72" />
	<property name="coupling_mass" value="0.446" />
	<property name="forearm_mass" value="4.935" />
	<property name="pitch_mass" value="0.679" />
	<property name="yaw_mass" value="4.689" />
	<property name="camera_mass" value="0.869" />
	<!-- Links COG -->
	<property name="base_cog" value="0 0 7e-3" />
	<property name="manifold_cog" value="0 2e-3 0.21" />
	<property name="upper_arm_cog" value="0 5e-3 0.227" />
	<property name="elbow_pivot_cog" value="-3.6e-10 80.686e-3 -6.33e-5" />
	<property name="coupling_cog" value="0 0 -0.26035" />
	<property name="forearm_cog" value="0 0.155337 0.012119" />
	<property name="pitch_cog" value="0 0.065 0" />
	<property name="yaw_cog" value="-1e-3 95.791e-3 18.273e-3" />
	<property name="camera_cog" value="0.077 0.007 0.002" />
	<!-- Links Inertia -->
	<macro name="base_inertia">
		<inertia ixx="0.003" ixy="0.0" ixz="0.0" iyy="0.003" iyz="0.0"
			izz="0.006" />
	</macro>
	<macro name="manifold_inertia">
		<inertia 	ixx="0.549" 	ixy="-9.556e-5"		ixz="-5.871e-5" 
							iyy="0.855"	iyz="2e-3" 
							izz="0.605" />
	</macro>
	<macro name="upper_arm_inertia">
		<inertia 	ixx="0.103" ixy="0" ixz="0" 
							iyy="0.106" iyz="0.004"
							izz="0.013" />
	</macro>
	<macro name="elbow_pivot_inertia">
		<inertia 	ixx="0.002" ixy="-3.231e-27" ixz="0" 
							iyy="3.397e-4" iyz="-1.919e-5"
							izz="0.002" />
	</macro>
	<macro name="coupling_inertia">
		<inertia 	ixx="0.011" ixy="-3.231e-27" ixz="0" 
							iyy="0.011" iyz="0" 
							izz="2.102e-5" />
	</macro>
	<macro name="forearm_inertia">
		<inertia 	ixx="0.073" ixy="0" ixz="0" 
							iyy="0.009" iyz="0.004"
							izz="0.073" />
	</macro>
	<macro name="pitch_inertia">
		<inertia 	ixx="0.003" ixy="0" ixz="0" 
							iyy="0.002" iyz="0.004"
							izz="0.002" />
	</macro>
	<macro name="yaw_inertia">
		<inertia 	ixx="0.027" ixy="1.597e-4" ixz="-2.174e-4" 
							iyy="0.009" iyz="-0.003" 
							izz="0.026" />
	</macro>
	<macro name="camera_inertia">
		<inertia 	ixx="0.001" ixy="-1.561e-4" ixz="-5.859e-5" 
							iyy="0.002" iyz="3.295e-5" 
							izz="0.002" />
	</macro>
	<!-- Meshes -->
	<property name="base_mesh" value="package://grips_description/meshes/base/base.dae" />
	<property name="manifold_mesh" value="package://grips_description/meshes/manifold/manifold.dae" />
	<property name="upper_arm_mesh" value="package://grips_description/meshes/upper_arm/upper_arm.dae" />
	<property name="elbow_pivot_mesh" value="package://grips_description/meshes/linkage/elbow_pivot.dae" />
	<property name="coupling_mesh" value="package://grips_description/meshes/linkage/coupling.dae" />
	<property name="forearm_mesh" value="package://grips_description/meshes/forearm/forearm.dae" />
	<property name="pitch_mesh" value="package://grips_description/meshes/pitch/pitch.dae" />
	<property name="yaw_mesh" value="package://grips_description/meshes/yaw/yaw.dae" />
	<property name="camera_mesh" value="package://grips_description/meshes/camera/camera.dae" />
	<!-- Joints Dynamics -->
	<property name="SA_damping" value="5" />
	<property name="SE_damping" value="5" />
	<property name="linkage_damping" value="0.5" />
	<property name="linkage_friction" value="0.5" />
	<property name="WP_damping" value="5" />
	<property name="WY_damping" value="5" />
	<property name="WR_damping" value="0.5" />

	<!-- base link -->
	<link_collision name="base_link" color="black" mesh="${base_mesh}" cog="${base_cog}" mass="${base_mass}" >
    <mesh filename="package://grips_description/meshes/base/base_collision.dae" />
		<base_inertia />
	</link_collision>
	<!-- manifold link -->
	<link_collision name="manifold_link" color="blue" mesh="${manifold_mesh}" cog="${manifold_cog}" mass="${manifold_mass}" >
    <mesh filename="package://grips_description/meshes/manifold/manifold_collision.dae" />
		<manifold_inertia />
	</link_collision>
	<!-- upper arm link -->
	<link_collision name="upper_arm_link" color="black" mesh="${upper_arm_mesh}" cog="${upper_arm_cog}" mass="${upper_arm_mass}" >
    <mesh filename="package://grips_description/meshes/upper_arm/upper_arm_collision.dae" />
		<upper_arm_inertia />
	</link_collision>
	<!-- elbow pivot link -->
	<create_link name="elbow_pivot_link" color="black" mesh="${elbow_pivot_mesh}" cog="${elbow_pivot_cog}" mass="${elbow_pivot_mass}" >
		<elbow_pivot_inertia />
	</create_link>
	<!-- coupling link -->
	<create_link name="coupling_link" color="black" mesh="${coupling_mesh}" cog="${coupling_cog}" mass="${coupling_mass}" >
		<coupling_inertia />
	</create_link>
	<!-- forearm link -->
	<link_collision name="forearm_link" color="black" mesh="${forearm_mesh}" cog="${forearm_cog}" mass="${forearm_mass}" >
    <mesh filename="package://grips_description/meshes/forearm/forearm_collision.dae" />
		<forearm_inertia />
	</link_collision>
	<!-- pitch link -->
	<link_collision name="pitch_link" color="black" mesh="${pitch_mesh}" cog="${pitch_cog}" mass="${pitch_mass}" >
    <mesh filename="package://grips_description/meshes/pitch/pitch_collision.dae" />
		<pitch_inertia />
	</link_collision>
	<!-- yaw link -->
	<link_collision name="yaw_link" color="black" mesh="${yaw_mesh}" cog="${yaw_cog}" mass="${yaw_mass}" >
    <mesh filename="package://grips_description/meshes/yaw/yaw_collision.dae" />
		<yaw_inertia />
	</link_collision>
	<!-- end effector dummy link -->
	<link name="end_effector" />
	<!-- camera link -->
	<link_collision name="camera_link" color="black" mesh="${camera_mesh}" cog="${camera_cog}" mass="${camera_mass}" >
    <mesh filename="package://grips_description/meshes/camera/camera_collision.dae" />
		<camera_inertia />
	</link_collision>
        
	<!-- Joints -->
	<joint name="SA" type="revolute">
		<child link="manifold_link" />
		<parent link="base_link" />
		<axis xyz="0 0 1" />
		<origin xyz="0 0 15.24e-3" rpy="0 0 0" />
		<limit lower="${-pi/2}" upper="${pi/2}" effort="${max_effort}" velocity="${max_velocity}" />
		<dynamics damping="${SA_damping}"/>
	</joint>
	<joint name="SE" type="revolute">
		<child link="upper_arm_link" />
		<parent link="manifold_link" />
		<axis xyz="1 0 0" />
		<origin xyz="0 0 0.33812" rpy="0 0 0" />
		<limit lower="${-pi/2}" upper="${pi/6}" effort="${max_effort}" velocity="${max_velocity}" />
		<dynamics damping="${SE_damping}" friction="10"/>
	</joint>
	<joint name="linkage_tr" type="revolute">
		<child link="forearm_link" />
		<parent link="upper_arm_link" />
		<axis xyz="1 0 0" />
		<origin xyz="0 -9.82e-3 0.52167" rpy="0 0 0" />
		<limit lower="-1.28" upper="${pi/3}" effort="${max_effort}" velocity="${max_velocity}" />
		<dynamics damping="10"/>
	</joint>
	<joint name="WP" type="revolute">
		<child link="pitch_link" />
		<parent link="forearm_link" />
		<axis xyz="1 0 0" />
		<origin xyz="0 0.26109 7.5e-3" rpy="0 0 0" />
		<limit lower="-1.1" upper="0.581" effort="${max_effort}" velocity="${max_velocity}" />
		<dynamics damping="${WP_damping}"/>
	</joint>
	<joint name="WY" type="revolute">
		<child link="yaw_link" />
		<parent link="pitch_link" />
		<axis xyz="0 0 1" />
		<origin xyz="0 0.13322 0" rpy="0 0 0" />
		<limit lower="-1.01" upper="0.675" effort="${max_effort}" velocity="${max_velocity}" />
		<dynamics damping="${WY_damping}"/>
	</joint>
	<joint name="WR" type="continuous">
		<child link="end_effector" />
		<parent link="yaw_link" />
		<axis xyz="0 1 0" />
		<origin xyz="-0.787e-3 0.190892 0.051331" rpy="0 0 0" />
		<limit effort="${max_effort}" velocity="200" />
		<dynamics damping="${WR_damping}"/>
	</joint>
	<joint name="camera_joint" type="fixed">
		<child link="camera_link"/>
    <parent link="yaw_link"/>
    <axis xyz="0 1 0" />
    <origin xyz="0 ${0.190892/2} 0.25" rpy="0 ${pi/6} ${pi/2}"/>    
  </joint>
	
	<!-- four-bar linkage -->
	<joint name="linkage_tl" type="continuous">
		<child link="coupling_link" />
		<parent link="forearm_link" />
		<axis xyz="1 0 0" />
		<origin xyz="0 -0.123444 0.029845" rpy="0.019320795 0 0" />
		<limit effort="${max_effort}" velocity="${max_velocity}" />
		<dynamics damping="${linkage_damping}" friction="${linkage_friction}"/>
	</joint>
	<joint name="linkage_bl" type="continuous">
		<child link="elbow_pivot_link" />
		<parent link="coupling_link" />
		<axis xyz="1 0 0" />
		<origin xyz="0 0 -0.5207" rpy="-0.24521876 0 0" />
		<limit effort="${max_effort}" velocity="${max_velocity}" />
		<dynamics damping="${linkage_damping}" friction="${linkage_friction}"/>
	</joint>

	<!-- Transmissions -->
	<simple_transmission joint="SA" />
	<simple_transmission joint="SE" />
	<simple_transmission joint="WP" />
	<simple_transmission joint="WY" />
	<simple_transmission joint="WR" />
	<simple_transmission joint="linkage_tr" />
	<simple_transmission joint="linkage_tl" />
	<simple_transmission joint="linkage_bl" />
</robot>
